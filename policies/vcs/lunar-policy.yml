version: 0

name: vcs
description: Version control system (VCS) best practices and security policies
author: earthly

policies:
  - name: branch-protection
    description: Validate branch protection rules are properly configured
    mainPython: ./branch-protection.py

  - name: repository-settings
    description: Validate repository settings including visibility, default branch, and merge strategies
    mainPython: ./repository-settings.py

inputs:
  require_enabled:
    description: Whether branch protection must be enabled. Set true to require enabled, false to require disabled, or omit to skip check
    default: null
  require_pr:
    description: Whether pull requests are required before merging. Set true to require PRs, false to require no PRs, or omit to skip check
    default: null
  min_approvals:
    description: Minimum number of required approvals (integer, or omit to skip check)
    default: null
  require_codeowner_review:
    description: Whether code owner review is required. Set true to require, false to forbid, or omit to skip check
    default: null
  require_dismiss_stale_reviews:
    description: Whether stale reviews must be dismissed on new commits. Set true to require, false to forbid, or omit to skip check
    default: null
  require_status_checks:
    description: Whether status checks are required to pass. Set true to require, false to forbid, or omit to skip check
    default: null
  require_up_to_date:
    description: Whether branches must be up to date before merging. Set true to require, false to forbid, or omit to skip check
    default: null
  disallow_force_push:
    description: Whether force pushes should be disallowed. Set true to disallow, false to require allowed, or omit to skip check
    default: null
  disallow_deletions:
    description: Whether branch deletions should be disallowed. Set true to disallow, false to require allowed, or omit to skip check
    default: null
  require_linear_history:
    description: Whether linear history is required. Set true to require, false to forbid, or omit to skip check
    default: null
  require_signed_commits:
    description: Whether signed commits are required. Set true to require, false to forbid, or omit to skip check
    default: null
  allowed_visibility:
    description: Comma-separated list of allowed repository visibility levels (public, private, internal, or omit to skip check)
    default: null
  required_default_branch:
    description: Required default branch name. Defaults to 'main'. Set to null to skip check
    default: "main"
  allowed_merge_strategies:
    description: Comma-separated list of allowed merge strategies (merge, squash, rebase). Only listed strategies will be allowed. Omit to skip check
    default: null
