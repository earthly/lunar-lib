version: 0

name: vcs
description: Version control system (VCS) best practices and security policies
author: earthly

policies:
  - name: branch-protection
    description: Validate branch protection rules are properly configured
    mainPython: ./branch-protection.py

  - name: repository-settings
    description: Validate repository settings including visibility, default branch, and merge strategies
    mainPython: ./repository-settings.py

inputs:
  require_enabled:
    description: Whether branch protection must be enabled (true/false, or omit to skip check)
    default: null
  require_pr:
    description: Whether pull requests are required before merging (true/false, or omit to skip check)
    default: null
  min_approvals:
    description: Minimum number of required approvals (integer, or omit to skip check)
    default: null
  require_codeowner_review:
    description: Whether code owner review is required (true/false, or omit to skip check)
    default: null
  require_dismiss_stale_reviews:
    description: Whether stale reviews must be dismissed on new commits (true/false, or omit to skip check)
    default: null
  require_status_checks:
    description: Whether status checks are required to pass (true/false, or omit to skip check)
    default: null
  require_up_to_date:
    description: Whether branches must be up to date before merging (true/false, or omit to skip check)
    default: null
  disallow_force_push:
    description: Whether force pushes should be disallowed (true/false, or omit to skip check)
    default: null
  disallow_deletions:
    description: Whether branch deletions should be disallowed (true/false, or omit to skip check)
    default: null
  require_linear_history:
    description: Whether linear history is required (true/false, or omit to skip check)
    default: null
  require_signed_commits:
    description: Whether signed commits are required (true/false, or omit to skip check)
    default: null
  allowed_visibility:
    description: Comma-separated list of allowed repository visibility levels (public, private, internal, or omit to skip check)
    default: null
  required_default_branch:
    description: Required default branch name (e.g., 'main', or omit to skip check)
    default: null
  allow_merge_commit:
    description: Whether merge commits should be allowed (true/false, or omit to skip check)
    default: null
  allow_squash_merge:
    description: Whether squash merges should be allowed (true/false, or omit to skip check)
    default: null
  allow_rebase_merge:
    description: Whether rebase merges should be allowed (true/false, or omit to skip check)
    default: null
