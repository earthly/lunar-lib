version: 0

name: vcs
description: Version control system (VCS) best practices and security policies
author: earthly

policies:
  - name: branch-protection-enabled
    description: Validate that branch protection is enabled or disabled as required
    mainPython: ./branch-protection-enabled.py

  - name: require-pull-request
    description: Validate that pull requests are required or not required as configured
    mainPython: ./require-pull-request.py

  - name: minimum-approvals
    description: Validate that pull requests require minimum number of approvals
    mainPython: ./minimum-approvals.py

  - name: require-codeowner-review
    description: Validate that code owner review is required or not required as configured
    mainPython: ./require-codeowner-review.py

  - name: dismiss-stale-reviews
    description: Validate that stale reviews are dismissed or not dismissed as configured
    mainPython: ./dismiss-stale-reviews.py

  - name: require-status-checks
    description: Validate that status checks are required or not required as configured
    mainPython: ./require-status-checks.py

  - name: require-branches-up-to-date
    description: Validate that branches are required to be up to date or not as configured
    mainPython: ./require-branches-up-to-date.py

  - name: disallow-force-push
    description: Validate that force pushes are allowed or disallowed as configured
    mainPython: ./disallow-force-push.py

  - name: disallow-branch-deletion
    description: Validate that branch deletions are allowed or disallowed as configured
    mainPython: ./disallow-branch-deletion.py

  - name: require-linear-history
    description: Validate that linear history is required or not required as configured
    mainPython: ./require-linear-history.py

  - name: require-signed-commits
    description: Validate that signed commits are required or not required as configured
    mainPython: ./require-signed-commits.py

  - name: repository-settings
    description: Validate repository settings including visibility, default branch, and merge strategies
    mainPython: ./repository-settings.py

inputs:
  require_enabled:
    description: Whether branch protection must be enabled. Set true to require enabled, false to require disabled, or omit to skip check
    default: null
  require_pr:
    description: Whether pull requests are required before merging. Set true to require PRs, false to require no PRs, or omit to skip check
    default: null
  min_approvals:
    description: Minimum number of required approvals (integer, or omit to skip check)
    default: null
  require_codeowner_review:
    description: Whether code owner review is required. Set true to require, false to forbid, or omit to skip check
    default: null
  require_dismiss_stale_reviews:
    description: Whether stale reviews must be dismissed on new commits. Set true to require, false to forbid, or omit to skip check
    default: null
  require_status_checks:
    description: Whether status checks are required to pass. Set true to require, false to forbid, or omit to skip check
    default: null
  require_up_to_date:
    description: Whether branches must be up to date before merging. Set true to require, false to forbid, or omit to skip check
    default: null
  disallow_force_push:
    description: Whether force pushes should be disallowed. Set true to disallow, false to require allowed, or omit to skip check
    default: null
  disallow_deletions:
    description: Whether branch deletions should be disallowed. Set true to disallow, false to require allowed, or omit to skip check
    default: null
  require_linear_history:
    description: Whether linear history is required. Set true to require, false to forbid, or omit to skip check
    default: null
  require_signed_commits:
    description: Whether signed commits are required. Set true to require, false to forbid, or omit to skip check
    default: null
  allowed_visibility:
    description: Comma-separated list of allowed repository visibility levels (public, private, or omit to skip check)
    default: null
  required_default_branch:
    description: Required default branch name. Defaults to 'main'. Set to null to skip check
    default: "main"
  allowed_merge_strategies:
    description: Comma-separated list of allowed merge strategies (merge, squash, rebase). Only listed strategies will be allowed. Omit to skip check
    default: null
