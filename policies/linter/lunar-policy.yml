version: 0

name: linter
description: Checks that linting ran and passes with acceptable warning count
author: earthly

default_image: earthly/lunar-lib:base-main

landing_page:
  display_name: "Linter Guardrails"
  long_description: |
    Enforce code quality standards by validating that linting tools run and pass.
    Ensures consistent code style, catches common bugs, and maintains codebase health
    by tracking lint warnings against configurable thresholds.
  category: "testing-and-quality"
  icon: "assets/linter.svg"
  status: "stable"
  requires:
    - slug: "golang"
      type: "collector"
      reason: "Provides lint data for Go projects via golangci-lint"
  related: []

policies:
  - name: ran
    description: |
      Ensures linting was executed for the specified language.
      Fails if no lint data is found, indicating the linter was not configured or did not run.
    mainPython: ./lint-ran.py
    keywords: ["linting", "code quality", "static analysis", "ci"]

  - name: max-warnings
    description: |
      Ensures lint warnings are at or below the maximum allowed threshold.
      Validates that the codebase maintains acceptable lint warning counts.
    mainPython: ./lint-warnings.py
    keywords: ["linting", "warnings", "code quality", "threshold"]

inputs:
  language:
    description: Programming language to check (e.g., "go", "java", "python")
    default: ""
  max_warnings:
    description: Maximum number of lint warnings allowed (0 = no warnings allowed)
    default: "0"
