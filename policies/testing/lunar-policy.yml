version: 0

name: testing
description: Validates that tests are executed and pass
author: support@earthly.dev

default_image: earthly/lunar-scripts:1.0.0

landing_page:
  display_name: "Testing Policies"
  long_description: |
    Ensure tests are executed in CI and passing. Works with any collector
    that writes to the normalized .testing paths.
  category: "testing-and-quality"
  icon: "assets/testing.svg"
  status: "stable"
  requires:
    - slug: "golang"
      type: "collector"
      reason: "Provides test execution data for Go projects"
  related: []

policies:
  - name: executed
    description: |
      Ensures tests were executed in CI.
      Fails if no test execution data is found.
    mainPython: ./executed.py
    keywords: ["tests", "ci", "test execution", "quality"]

  - name: passing
    description: |
      Ensures all tests pass. Skips if pass/fail data is not available
      (some collectors only report execution, not results).
    mainPython: ./passing.py
    keywords: ["tests", "passing", "test results", "quality"]

inputs:
  required_languages:
    description: |
      Comma-separated list of languages that require tests.
      Components without a detected project for any of these languages will be skipped.
      Checks for .lang.<language> existence (set by language collectors like golang, python, etc.)
      Example: "go,python,nodejs,java"
      If empty, the policy applies to all components.
    default: ""
