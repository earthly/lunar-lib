version: 0

name: container
description: Container definition policies
author: earthly

default_image: earthly/lunar-lib:base-main

policies:
  - name: no-latest
    description: Container definitions should not use the :latest tag
    mainPython: no_latest.py

  - name: stable-tags
    description: Container definitions should use stable tags (digests or full semver)
    mainPython: stable_tags.py

  - name: allowed-registries
    description: Container definitions should only use allowed registries
    mainPython: allowed_registries.py

  - name: required-labels
    description: Container definitions should have required labels
    mainPython: required_labels.py

  - name: healthcheck
    description: Container definitions should have HEALTHCHECK instruction
    mainPython: healthcheck.py

  - name: user
    description: Container definitions should specify USER instruction
    mainPython: user.py

inputs:
  allowed_registries:
    description: Comma-separated list of allowed registries
    default: "docker.io"
  required_labels:
    description: Comma-separated list of required labels (empty = no requirement)
    default: ""
