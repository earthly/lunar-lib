version: 0

name: claude
description: Run Claude AI prompts against repository code and collect structured results
author: earthly

image: +image

landing_page:
  display_name: "Claude Collector"
  long_description: |
    Execute Claude AI prompts against your repository to extract insights, detect patterns,
    and analyze code that's difficult to capture with traditional pattern matching.
  category: "code-analysis"
  icon: "assets/claude.svg"
  status: "beta"
  related:
    - slug: "ast-grep"
      type: "collector"
      reason: "Use ast-grep for syntax-aware pattern matching without AI"

collectors:
  - name: claude
    description: |
      Runs a Claude AI prompt against the repository and collects the results.
      Supports optional JSON schema enforcement for structured output.
      Use cases include:
      - Feature flag detection and inventory
      - Documentation quality analysis
      - Graceful shutdown handling verification
      - Architecture pattern detection
    mainBash: main.sh
    hook:
      type: code
    keywords: ["claude", "ai", "llm", "code analysis", "pattern detection", "anthropic"]

inputs:
  path:
    description: JSON component path to write the results to (e.g., ".code_patterns.feature_flags")
  prompt:
    description: Prompt for Claude to run on the component repository
  json_schema:
    description: Optional JSON schema for structured output. If provided, Claude will return results conforming to this schema.

secrets:
  - name: ANTHROPIC_API_KEY
    description: Anthropic API key for Claude authentication
    required: true

example_component_json: |
  {
    "code_patterns": {
      "feature_flags": {
        "library": "custom",
        "flags": [
          {
            "key": "enable_new_checkout",
            "file": "src/checkout/handler.go",
            "line": 42,
            "variation_type": "bool"
          }
        ],
        "count": 1
      }
    }
  }


