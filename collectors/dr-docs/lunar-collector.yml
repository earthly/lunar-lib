version: 0

name: dr-docs
description: Collect disaster recovery plan and exercise documentation
author: earthly
default_image: earthly/lunar-lib:base-main

landing_page:
  display_name: "DR Documentation Collector"
  long_description: |
    Parse disaster recovery plan and exercise documentation to extract RTO/RPO
    targets, exercise dates, review timestamps, and section headings. Verify
    that teams document and regularly practice recovery procedures.
  categories: ["documentation"]
  icon: "assets/dr-docs.svg"
  status: "stable"
  related:
    - slug: "compliance-docs"
      type: "policy"
      reason: "Enforces DR readiness requirements based on collected data"

collectors:
  - name: dr-plan
    description: |
      Collects the disaster recovery plan document (default: `docs/dr-plan.md`).
      Expects YAML frontmatter with recovery objectives (rto_minutes, rpo_minutes),
      review metadata (last_reviewed, approver), and a Markdown body with sections
      covering recovery procedures.
    mainBash: plan.sh
    hook:
      type: code
    keywords: ["disaster recovery", "DR plan", "RTO", "RPO", "compliance", "operational readiness"]

  - name: dr-exercise
    description: |
      Collects DR exercise records from a directory (default: `docs/dr-exercises/`).
      Each exercise is a date-prefixed Markdown file (e.g., `2025-11-15.md` or
      `2025-11-15-database-failover.md`) with optional YAML frontmatter for
      exercise type and body sections documenting the scenario and outcomes.
      Provides full exercise history and summary metrics.
    mainBash: exercise.sh
    hook:
      type: code
    keywords: ["DR exercise", "tabletop exercise", "game day", "compliance", "operational readiness"]

inputs:
  plan_paths:
    description: Comma-separated list of candidate paths to the DR plan document (first match wins)
    default: "docs/dr-plan.md"
  exercise_dir_paths:
    description: Comma-separated list of candidate directories for DR exercise records (first match wins)
    default: "docs/dr-exercises"

example_component_json: |
  {
    "oncall": {
      "disaster_recovery": {
        "plan": {
          "exists": true,
          "path": "docs/dr-plan.md",
          "rto_defined": true,
          "rto_minutes": 60,
          "rpo_defined": true,
          "rpo_minutes": 15,
          "last_reviewed": "2025-12-01",
          "days_since_review": 73,
          "approver": "jane.doe@company.com",
          "sections": [
            "Overview",
            "Recovery Steps",
            "Contact List",
            "Dependencies"
          ]
        },
        "exercises": [
          {
            "date": "2025-11-15",
            "path": "docs/dr-exercises/2025-11-15.md",
            "exercise_type": "tabletop",
            "sections": [
              "Scenario",
              "Recovery Steps Tested",
              "Participants",
              "Action Items",
              "Lessons Learned"
            ]
          },
          {
            "date": "2025-05-20",
            "path": "docs/dr-exercises/2025-05-20.md",
            "exercise_type": "failover",
            "sections": [
              "Scenario",
              "Recovery Steps Tested",
              "Participants"
            ]
          }
        ],
        "latest_exercise_date": "2025-11-15",
        "days_since_latest_exercise": 89,
        "exercise_count": 2
      }
    }
  }
