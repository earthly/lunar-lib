version: 0

name: dr-docs
description: Collect disaster recovery plan and exercise documentation
author: earthly
default_image: earthly/lunar-lib:base-main

landing_page:
  display_name: "DR Documentation Collector"
  long_description: |
    Parse disaster recovery plan and exercise documentation to extract RTO/RPO
    targets, exercise dates, review timestamps, and section headings. Verify
    that teams document and regularly practice recovery procedures.
  categories: ["documentation"]
  icon: "assets/dr-docs.svg"
  status: "stable"
  related:
    - slug: "compliance-docs"
      type: "policy"
      reason: "Enforces DR readiness requirements based on collected data"

default_image_non_ci_collectors: earthly/lunar-lib:base-main

collectors:
  - name: dr-plan
    description: |
      Scans the repository for a disaster recovery plan document (default:
      `docs/dr-plan.md`). Expects YAML frontmatter with recovery objectives
      (rto_minutes, rpo_minutes), review metadata (last_reviewed, approver),
      and a Markdown body with sections covering recovery procedures. Writes
      results to `.oncall.disaster_recovery.plan`.
    mainBash: plan.sh
    hook:
      type: code
    keywords: ["disaster recovery", "DR plan", "RTO", "RPO", "compliance", "operational readiness"]

  - name: dr-exercise
    description: |
      Scans a directory of DR exercise records (default: `docs/dr-exercises/`).
      Each exercise is a date-named Markdown file (YYYY-MM-DD.md) with optional
      YAML frontmatter (exercise_type) and body sections documenting the scenario,
      steps tested, and outcomes. Collects all exercises into an array and
      computes summary fields (latest date, days since, count). Writes results
      to `.oncall.disaster_recovery.exercises[]`.
    mainBash: exercise.sh
    hook:
      type: code
    keywords: ["DR exercise", "tabletop exercise", "game day", "compliance", "operational readiness"]

inputs:
  plan_path:
    description: Comma-separated list of candidate paths to the DR plan document (first match wins)
    default: "docs/dr-plan.md"
  exercise_dir:
    description: Directory containing DR exercise records (YYYY-MM-DD.md files)
    default: "docs/dr-exercises"

example_component_json: |
  {
    "oncall": {
      "disaster_recovery": {
        "plan": {
          "exists": true,
          "path": "docs/dr-plan.md",
          "rto_defined": true,
          "rto_minutes": 60,
          "rpo_defined": true,
          "rpo_minutes": 15,
          "last_reviewed": "2025-12-01",
          "days_since_review": 73,
          "approver": "jane.doe@company.com",
          "sections": [
            "Overview",
            "Recovery Steps",
            "Contact List",
            "Dependencies"
          ]
        },
        "exercises": [
          {
            "date": "2025-11-15",
            "path": "docs/dr-exercises/2025-11-15.md",
            "exercise_type": "tabletop",
            "sections": [
              "Scenario",
              "Recovery Steps Tested",
              "Participants",
              "Action Items",
              "Lessons Learned"
            ]
          },
          {
            "date": "2025-05-20",
            "path": "docs/dr-exercises/2025-05-20.md",
            "exercise_type": "failover",
            "sections": [
              "Scenario",
              "Recovery Steps Tested",
              "Participants"
            ]
          }
        ],
        "latest_exercise_date": "2025-11-15",
        "days_since_latest_exercise": 89,
        "exercise_count": 2
      }
    }
  }
