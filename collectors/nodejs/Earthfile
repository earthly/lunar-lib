VERSION 0.8

image:
    # Use Debian variant for glibc compatibility with Node.js binaries
    ARG SCRIPTS_VERSION=main-debian
    FROM earthly/lunar-scripts:$SCRIPTS_VERSION

    # Install Node.js (download from official source for latest LTS)
    ARG NODE_VERSION=22.14.0
    ARG TARGETARCH
    RUN ARCH=$(echo "${TARGETARCH}" | sed 's/amd64/x64/') && \
        wget -q "https://nodejs.org/dist/v${NODE_VERSION}/node-v${NODE_VERSION}-linux-${ARCH}.tar.gz" -O node.tar.gz && \
        tar -xzf node.tar.gz -C /usr/local --strip-components=1 && \
        rm node.tar.gz

    # Verify installation
    RUN node --version && npm --version

    ARG VERSION=main
    SAVE IMAGE --push earthly/lunar-lib:nodejs-$VERSION
